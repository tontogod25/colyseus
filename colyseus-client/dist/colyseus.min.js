!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.Colyseus=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)},WebSocketClient=require("websocket.js"),msgpack=require("msgpack-lite"),jsonpatch=require("fast-json-patch"),protocol=require("./protocol"),Room=require("./lib/Room"),Colyseus=function(_WebSocketClient){function Colyseus(url){var protocols=arguments.length<=1||void 0===arguments[1]?null:arguments[1],options=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];_classCallCheck(this,Colyseus);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Colyseus).call(this,url,protocols,options));return _this.binaryType="arraybuffer",_this.roomStates={},_this.rooms={},_this._enqueuedCalls=[],_this}return _inherits(Colyseus,_WebSocketClient),_createClass(Colyseus,[{key:"onOpenCallback",value:function(event){if(this._enqueuedCalls.length>0)for(var i=0;i<this._enqueuedCalls.length;i++){var _enqueuedCalls$i=_slicedToArray(this._enqueuedCalls[i],2),method=_enqueuedCalls$i[0],args=_enqueuedCalls$i[1];this[method].apply(this,args)}}},{key:"send",value:function(data){return _get(Object.getPrototypeOf(Colyseus.prototype),"send",this).call(this,msgpack.encode(data))}},{key:"join",value:function(roomName,options){return this.ws.readyState==WebSocket.OPEN?this.send([protocol.JOIN_ROOM,roomName,options||{}]):this._enqueuedCalls.push(["join",arguments]),this.rooms[roomName]||(this.rooms[roomName]=new Room(this,roomName)),this.rooms[roomName]}},{key:"leave",value:function(roomNameOrId){"number"!=typeof roomNameOrId&&this.rooms[roomNameOrId]&&(roomNameOrId=this.rooms[roomNameOrId]),this.send([protocol.LEAVE_ROOM,roomName])}},{key:"onMessageCallback",value:function(event){var message=msgpack.decode(new Uint8Array(event.data));if("number"==typeof message[0]){var roomId=message[1];if(message[0]==protocol.USER_ID)return this.id=message[1],this.listeners.onopen&&this.listeners.onopen.apply(null),!0;if(message[0]==protocol.JOIN_ROOM)return this.rooms[roomId]=this.rooms[message[2]],this.rooms[roomId].roomId=roomId,this.rooms[roomId].emit("join"),!0;if(message[0]==protocol.JOIN_ERROR)return this.rooms[roomId].emit("error",message[2]),delete this.rooms[roomId],!0;if(message[0]==protocol.LEAVE_ROOM)return this.rooms[roomId].emit("leave"),!0;if(message[0]==protocol.ROOM_STATE){var roomState=message[2];return this.rooms[roomId].state=roomState,this.rooms[roomId].emit("setup",this.rooms[roomId].state),this.roomStates[roomId]=roomState,!0}if(message[0]==protocol.ROOM_STATE_PATCH)return this.rooms[roomId].emit("patch",message[2]),jsonpatch.apply(this.roomStates[roomId],message[2]),this.rooms[roomId].emit("update",this.roomStates[roomId]),!0;message[0]==protocol.ROOM_DATA&&(this.rooms[roomId].emit("data",message[2]),message=[message[2]])}this.listeners.onmessage&&this.listeners.onmessage.apply(null,message)}}]),Colyseus}(WebSocketClient);module.exports=Colyseus},{"./lib/Room":2,"./protocol":43,"fast-json-patch":13,"msgpack-lite":17,"websocket.js":42}],2:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),EventEmitter=require("events").EventEmitter,protocol=require("../protocol"),Room=function(_EventEmitter){function Room(client,name){_classCallCheck(this,Room);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Room).call(this));return _this.roomId=null,_this.client=client,_this.name=name,_this.state={},_this}return _inherits(Room,_EventEmitter),_createClass(Room,[{key:"leave",value:function(){this.roomId&&this.client.send([protocol.LEAVE_ROOM,this.roomId])}}]),Room}(EventEmitter);module.exports=Room},{"../protocol":43,events:12}],3:[function(require,module,exports){var Backoff=require("./lib/backoff"),ExponentialBackoffStrategy=require("./lib/strategy/exponential"),FibonacciBackoffStrategy=require("./lib/strategy/fibonacci"),FunctionCall=require("./lib/function_call.js");module.exports.Backoff=Backoff,module.exports.FunctionCall=FunctionCall,module.exports.FibonacciStrategy=FibonacciBackoffStrategy,module.exports.ExponentialStrategy=ExponentialBackoffStrategy,module.exports.fibonacci=function(options){return new Backoff(new FibonacciBackoffStrategy(options))},module.exports.exponential=function(options){return new Backoff(new ExponentialBackoffStrategy(options))},module.exports.call=function(fn,vargs,callback){var args=Array.prototype.slice.call(arguments);return fn=args[0],vargs=args.slice(1,args.length-1),callback=args[args.length-1],new FunctionCall(fn,vargs,callback)}},{"./lib/backoff":4,"./lib/function_call.js":5,"./lib/strategy/exponential":6,"./lib/strategy/fibonacci":7}],4:[function(require,module,exports){function Backoff(backoffStrategy){events.EventEmitter.call(this),this.backoffStrategy_=backoffStrategy,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}var events=require("events"),precond=require("precond"),util=require("util");util.inherits(Backoff,events.EventEmitter),Backoff.prototype.failAfter=function(maxNumberOfRetry){precond.checkArgument(maxNumberOfRetry>0,"Expected a maximum number of retry greater than 0 but got %s.",maxNumberOfRetry),this.maxNumberOfRetry_=maxNumberOfRetry},Backoff.prototype.backoff=function(err){precond.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",err),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,err))},Backoff.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},Backoff.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},module.exports=Backoff},{events:12,precond:36,util:41}],5:[function(require,module,exports){function FunctionCall(fn,args,callback){events.EventEmitter.call(this),precond.checkIsFunction(fn,"Expected fn to be a function."),precond.checkIsArray(args,"Expected args to be an array."),precond.checkIsFunction(callback,"Expected callback to be a function."),this.function_=fn,this.arguments_=args,this.callback_=callback,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.state_=FunctionCall.State_.PENDING}var events=require("events"),precond=require("precond"),util=require("util"),Backoff=require("./backoff"),FibonacciBackoffStrategy=require("./strategy/fibonacci");util.inherits(FunctionCall,events.EventEmitter),FunctionCall.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},FunctionCall.prototype.isPending=function(){return this.state_==FunctionCall.State_.PENDING},FunctionCall.prototype.isRunning=function(){return this.state_==FunctionCall.State_.RUNNING},FunctionCall.prototype.isCompleted=function(){return this.state_==FunctionCall.State_.COMPLETED},FunctionCall.prototype.isAborted=function(){return this.state_==FunctionCall.State_.ABORTED},FunctionCall.prototype.setStrategy=function(strategy){return precond.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=strategy,this},FunctionCall.prototype.getLastResult=function(){return this.lastResult_.concat()},FunctionCall.prototype.getNumRetries=function(){return this.numRetries_},FunctionCall.prototype.failAfter=function(maxNumberOfRetry){return precond.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=maxNumberOfRetry,this},FunctionCall.prototype.abort=function(){precond.checkState(!this.isCompleted(),"FunctionCall already completed."),this.isRunning()&&this.backoff_.reset(),this.state_=FunctionCall.State_.ABORTED},FunctionCall.prototype.start=function(backoffFactory){precond.checkState(!this.isAborted(),"FunctionCall aborted."),precond.checkState(this.isPending(),"FunctionCall already started.");var strategy=this.strategy_||new FibonacciBackoffStrategy;this.backoff_=backoffFactory?backoffFactory(strategy):new Backoff(strategy),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=FunctionCall.State_.RUNNING,this.doCall_(!1)},FunctionCall.prototype.doCall_=function(isRetry){isRetry&&this.numRetries_++;var eventArgs=["call"].concat(this.arguments_);events.EventEmitter.prototype.emit.apply(this,eventArgs);var callback=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(callback))},FunctionCall.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},FunctionCall.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var args=Array.prototype.slice.call(arguments);this.lastResult_=args,events.EventEmitter.prototype.emit.apply(this,["callback"].concat(args)),args[0]?this.backoff_.backoff(args[0]):(this.state_=FunctionCall.State_.COMPLETED,this.doCallback_())}},FunctionCall.prototype.handleBackoff_=function(number,delay,err){this.emit("backoff",number,delay,err)},module.exports=FunctionCall},{"./backoff":4,"./strategy/fibonacci":7,events:12,precond:36,util:41}],6:[function(require,module,exports){function ExponentialBackoffStrategy(options){BackoffStrategy.call(this,options),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=ExponentialBackoffStrategy.DEFAULT_FACTOR,options&&void 0!==options.factor&&(precond.checkArgument(options.factor>1,"Exponential factor should be greater than 1 but got %s.",options.factor),this.factor_=options.factor)}var util=require("util"),precond=require("precond"),BackoffStrategy=require("./strategy");util.inherits(ExponentialBackoffStrategy,BackoffStrategy),ExponentialBackoffStrategy.DEFAULT_FACTOR=2,ExponentialBackoffStrategy.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},ExponentialBackoffStrategy.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},module.exports=ExponentialBackoffStrategy},{"./strategy":8,precond:36,util:41}],7:[function(require,module,exports){function FibonacciBackoffStrategy(options){BackoffStrategy.call(this,options),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}var util=require("util"),BackoffStrategy=require("./strategy");util.inherits(FibonacciBackoffStrategy,BackoffStrategy),FibonacciBackoffStrategy.prototype.next_=function(){var backoffDelay=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=backoffDelay,backoffDelay},FibonacciBackoffStrategy.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},module.exports=FibonacciBackoffStrategy},{"./strategy":8,util:41}],8:[function(require,module,exports){function isDef(value){return void 0!==value&&null!==value}function BackoffStrategy(options){if(options=options||{},isDef(options.initialDelay)&&options.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(isDef(options.maxDelay)&&options.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=options.initialDelay||100,this.maxDelay_=options.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(isDef(options.randomisationFactor)&&(options.randomisationFactor<0||options.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=options.randomisationFactor||0}require("events"),require("util");BackoffStrategy.prototype.getMaxDelay=function(){return this.maxDelay_},BackoffStrategy.prototype.getInitialDelay=function(){return this.initialDelay_},BackoffStrategy.prototype.next=function(){var backoffDelay=this.next_(),randomisationMultiple=1+Math.random()*this.randomisationFactor_,randomizedDelay=Math.round(backoffDelay*randomisationMultiple);return randomizedDelay},BackoffStrategy.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},BackoffStrategy.prototype.reset=function(){this.reset_()},BackoffStrategy.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},module.exports=BackoffStrategy},{events:12,util:41}],9:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){"use strict";function decode(elt){var code=elt.charCodeAt(0);return code===PLUS||code===PLUS_URL_SAFE?62:code===SLASH||code===SLASH_URL_SAFE?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0),PLUS_URL_SAFE="-".charCodeAt(0),SLASH_URL_SAFE="_".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}("undefined"==typeof exports?this.base64js={}:exports)},{}],10:[function(require,module,exports){(function(global){function typedArraySupport(){function Bar(){}try{var arr=new Uint8Array(1);return arr.foo=function(){return 42},arr.constructor=Bar,42===arr.foo()&&arr.constructor===Bar&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){return this instanceof Buffer?(this.length=0,this.parent=void 0,"number"==typeof arg?fromNumber(this,arg):"string"==typeof arg?fromString(this,arg,arguments.length>1?arguments[1]:"utf8"):fromObject(this,arg)):arguments.length>1?new Buffer(arg,arguments[1]):new Buffer(arg)}function fromNumber(that,length){if(that=allocate(that,0>length?0:0|checked(length)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;length>i;i++)that[i]=0;return that}function fromString(that,string,encoding){("string"!=typeof encoding||""===encoding)&&(encoding="utf8");var length=0|byteLength(string,encoding);return that=allocate(that,length),that.write(string,encoding),that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(null==object)throw new TypeError("must start with number, buffer, array or string");if("undefined"!=typeof ArrayBuffer){if(object.buffer instanceof ArrayBuffer)return fromTypedArray(that,object);if(object instanceof ArrayBuffer)return fromArrayBuffer(that,object)}return object.length?fromArrayLike(that,object):fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=0|checked(buffer.length);return that=allocate(that,length),buffer.copy(that,0,0,length),that}function fromArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromTypedArray(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromArrayBuffer(that,array){return Buffer.TYPED_ARRAY_SUPPORT?(array.byteLength,that=Buffer._augment(new Uint8Array(array))):that=fromTypedArray(that,new Uint8Array(array)),that}function fromArrayLike(that,array){var length=0|checked(array.length);that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function fromJsonObject(that,object){var array,length=0;"Buffer"===object.type&&isArray(object.data)&&(array=object.data,length=0|checked(array.length)),that=allocate(that,length);for(var i=0;length>i;i+=1)that[i]=255&array[i];return that}function allocate(that,length){Buffer.TYPED_ARRAY_SUPPORT?(that=Buffer._augment(new Uint8Array(length)),that.__proto__=Buffer.prototype):(that.length=length,that._isBuffer=!0);var fromPool=0!==length&&length<=Buffer.poolSize>>>1;return fromPool&&(that.parent=rootParent),that}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);return delete buf.parent,buf}function byteLength(string,encoding){"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if(start=0|start,end=void 0===end||end===1/0?this.length:0|end,encoding||(encoding="utf8"),0>start&&(start=0),end>this.length&&(end=this.length),start>=end)return"";for(;;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;end>i;){var firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(end>=i+bytesPerSequence){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:128>firstByte&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128===(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte,tempCodePoint>127&&(codePoint=tempCodePoint));break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128===(192&secondByte)&&128===(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte,tempCodePoint>2047&&(55296>tempCodePoint||tempCodePoint>57343)&&(codePoint=tempCodePoint));break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte,tempCodePoint>65535&&1114112>tempCodePoint&&(codePoint=tempCodePoint))}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(MAX_ARGUMENTS_LENGTH>=len)return String.fromCharCode.apply(String,codePoints);for(var res="",i=0;len>i;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(127&buf[i]);return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){0>value&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){0>value&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||min>value)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(0>offset)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;length>i;i++){if(codePoint=string.charCodeAt(i),codePoint>55295&&57344>codePoint){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,128>codePoint){if((units-=1)<0)break;bytes.push(codePoint)}else if(2048>codePoint){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(65536>codePoint){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(1114112>codePoint))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}var base64=require("base64-js"),ieee754=require("ieee754"),isArray=require("is-array");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array),Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];)++i;return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(0===list.length)return new Buffer(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;i++)length+=list[i].length;var buf=new Buffer(length),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.byteLength=byteLength,Buffer.prototype.length=void 0,Buffer.prototype.parent=void 0,Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?!0:0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(b){
if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b?0:Buffer.compare(this,b)},Buffer.prototype.indexOf=function(val,byteOffset){function arrayIndexOf(arr,val,byteOffset){for(var foundIndex=-1,i=0;byteOffset+i<arr.length;i++)if(arr[byteOffset+i]===val[-1===foundIndex?0:i-foundIndex]){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===val.length)return byteOffset+foundIndex}else foundIndex=-1;return-1}if(byteOffset>2147483647?byteOffset=2147483647:-2147483648>byteOffset&&(byteOffset=-2147483648),byteOffset>>=0,0===this.length)return-1;if(byteOffset>=this.length)return-1;if(0>byteOffset&&(byteOffset=Math.max(this.length+byteOffset,0)),"string"==typeof val)return 0===val.length?-1:String.prototype.indexOf.call(this,val,byteOffset);if(Buffer.isBuffer(val))return arrayIndexOf(this,val,byteOffset);if("number"==typeof val)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,val,byteOffset):arrayIndexOf(this,[val],byteOffset);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else if(isFinite(offset))offset=0|offset,isFinite(length)?(length=0|length,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=0|length,length=swap}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(0>length||0>offset)||offset>this.length)throw new RangeError("attempt to write outside buffer bounds");encoding||(encoding="utf8");for(var loweredCase=!1;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,0>start?(start+=len,0>start&&(start=0)):start>len&&(start=len),0>end?(end+=len,0>end&&(end=0)):end>len&&(end=len),start>end&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=Buffer._augment(this.subarray(start,end));else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;sliceLen>i;i++)newBuf[i]=this[i+start]}return newBuf.length&&(newBuf.parent=this.parent||this),newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value,offset=0|offset,byteLength=0|byteLength,noAssert||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0>value?1:0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0>value?1:0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),0>value&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),0>value&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&start>end&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart)throw new RangeError("targetStart out of bounds");if(0>start||start>=this.length)throw new RangeError("sourceStart out of bounds");if(0>end)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var i,len=end-start;if(this===target&&targetStart>start&&end>targetStart)for(i=len-1;i>=0;i--)target[i+targetStart]=this[i+start];else if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;len>i;i++)target[i+targetStart]=this[i+start];else target._set(this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),start>end)throw new RangeError("end < start");if(end!==start&&0!==this.length){if(0>start||start>=this.length)throw new RangeError("start out of bounds");if(0>end||end>this.length)throw new RangeError("end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer.TYPED_ARRAY_SUPPORT)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr.constructor=Buffer,arr._isBuffer=!0,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.indexOf=BP.indexOf,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUIntLE=BP.readUIntLE,arr.readUIntBE=BP.readUIntBE,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readIntLE=BP.readIntLE,arr.readIntBE=BP.readIntBE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUIntLE=BP.writeUIntLE,arr.writeUIntBE=BP.writeUIntBE,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeIntLE=BP.writeIntLE,arr.writeIntBE=BP.writeIntBE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base64-js":9,ieee754:14,"is-array":16}],11:[function(require,module,exports){function EventLite(){return this instanceof EventLite?void 0:new EventLite}!function(EventLite){function mixin(target){for(var key in methods)target[key]=methods[key];return target}function on(type,func){return getListeners(this,type).push(func),this}function once(type,func){function wrap(){off.call(that,type,wrap),func.apply(this,arguments)}var that=this;return getListeners(that,type).push(wrap),that}function off(type,func){function ne(test){return test!==func}var listners,that=this;if(type){if(func){if(listners=getListeners(that,type,!0)){if(listners=listners.filter(ne),!listners.length)return off.call(that,type);that[LISTENERS][type]=listners}}else if(listners=that[LISTENERS],listners&&(delete listners[type],!Object.keys(listners).length))return off.call(that)}else delete that[LISTENERS];return that}function emit(type,value){function zeroarg(func){func.call(that)}function onearg(func){func.call(that,value)}function moreargs(func){func.apply(that,args)}var that=this,listeners=getListeners(that,type,!0);if(!listeners)return!1;var arglen=arguments.length;if(1===arglen)listeners.forEach(zeroarg);else if(2===arglen)listeners.forEach(onearg);else{var args=Array.prototype.slice.call(arguments,1);listeners.forEach(moreargs)}return!!listeners.length}function getListeners(that,type,readonly){if(!readonly||that[LISTENERS]){var listeners=that[LISTENERS]||(that[LISTENERS]={});return listeners[type]||(listeners[type]=[])}}"undefined"!=typeof module&&(module.exports=EventLite);var LISTENERS="listeners",methods={on:on,once:once,off:off,emit:emit};mixin(EventLite.prototype),EventLite.mixin=mixin}(EventLite)},{}],12:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],13:[function(require,module,exports){var jsonpatch,__extends=this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);__.prototype=b.prototype,d.prototype=new __},OriginalError=Error;!function(jsonpatch){function _equals(a,b){switch(typeof a){case"undefined":case"boolean":case"string":case"number":return a===b;case"object":if(null===a)return null===b;if(_isArray(a)){if(!_isArray(b)||a.length!==b.length)return!1;for(var i=0,l=a.length;l>i;i++)if(!_equals(a[i],b[i]))return!1;return!0}var bKeys=_objectKeys(b),bLength=bKeys.length;if(_objectKeys(a).length!==bLength)return!1;for(var i=0;bLength>i;i++)if(!_equals(a[i],b[i]))return!1;return!0;default:return!1}}function escapePathComponent(str){return-1===str.indexOf("/")&&-1===str.indexOf("~")?str:str.replace(/~/g,"~0").replace(/\//g,"~1")}function _getPathRecursive(root,obj){var found;for(var key in root)if(root.hasOwnProperty(key)){if(root[key]===obj)return escapePathComponent(key)+"/";if("object"==typeof root[key]&&(found=_getPathRecursive(root[key],obj),""!=found))return escapePathComponent(key)+"/"+found}return""}function getPath(root,obj){if(root===obj)return"/";var path=_getPathRecursive(root,obj);if(""===path)throw new OriginalError("Object not found in root");return"/"+path}function getMirror(obj){for(var i=0,ilen=beforeDict.length;ilen>i;i++)if(beforeDict[i].obj===obj)return beforeDict[i]}function getObserverFromMirror(mirror,callback){for(var j=0,jlen=mirror.observers.length;jlen>j;j++)if(mirror.observers[j].callback===callback)return mirror.observers[j].observer}function removeObserverFromMirror(mirror,observer){for(var j=0,jlen=mirror.observers.length;jlen>j;j++)if(mirror.observers[j].observer===observer)return void mirror.observers.splice(j,1)}function unobserve(root,observer){generate(observer),Object.observe?_unobserve(observer,root):clearTimeout(observer.next);var mirror=getMirror(root);removeObserverFromMirror(mirror,observer)}function deepClone(obj){return"object"==typeof obj?JSON.parse(JSON.stringify(obj)):obj}function observe(obj,callback){var observer,patches=[],root=obj,mirror=getMirror(obj);if(mirror?observer=getObserverFromMirror(mirror,callback):(mirror=new Mirror(obj),beforeDict.push(mirror)),observer)return observer;if(Object.observe)observer=function(arr){_unobserve(observer,obj),_observe(observer,obj);for(var a=0,alen=arr.length;alen>a;)"length"===arr[a].name&&_isArray(arr[a].object)||"__Jasmine_been_here_before__"===arr[a].name||observeOps[arr[a].type].call(arr[a],patches,getPath(root,arr[a].object)),a++;patches&&callback&&callback(patches),observer.patches=patches,patches=[]};else if(observer={},mirror.value=deepClone(obj),callback){observer.callback=callback,observer.next=null;var intervals=this.intervals||[100,1e3,1e4,6e4];if(void 0===intervals.push)throw new OriginalError("jsonpatch.intervals must be an array");var currentInterval=0,dirtyCheck=function(){generate(observer)},fastCheck=function(){clearTimeout(observer.next),observer.next=setTimeout(function(){dirtyCheck(),currentInterval=0,observer.next=setTimeout(slowCheck,intervals[currentInterval++])},0)},slowCheck=function(){dirtyCheck(),currentInterval==intervals.length&&(currentInterval=intervals.length-1),observer.next=setTimeout(slowCheck,intervals[currentInterval++])};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mousedown",fastCheck),window.addEventListener("mouseup",fastCheck),window.addEventListener("keydown",fastCheck)):(document.documentElement.attachEvent("onmousedown",fastCheck),document.documentElement.attachEvent("onmouseup",fastCheck),document.documentElement.attachEvent("onkeydown",fastCheck))),observer.next=setTimeout(slowCheck,intervals[currentInterval++])}return observer.patches=patches,observer.object=obj,mirror.observers.push(new ObserverInfo(callback,observer)),_observe(observer,obj)}function _observe(observer,obj){if(Object.observe){Object.observe(obj,observer);for(var key in obj)if(obj.hasOwnProperty(key)){var v=obj[key];v&&"object"==typeof v&&_observe(observer,v)}}return observer}function _unobserve(observer,obj){if(Object.observe){Object.unobserve(obj,observer);for(var key in obj)if(obj.hasOwnProperty(key)){var v=obj[key];v&&"object"==typeof v&&_unobserve(observer,v)}}return observer}function generate(observer){if(Object.observe)Object.deliverChangeRecords(observer);else{for(var mirror,i=0,ilen=beforeDict.length;ilen>i;i++)if(beforeDict[i].obj===observer.object){mirror=beforeDict[i];break}_generate(mirror.value,observer.object,observer.patches,""),observer.patches.length&&apply(mirror.value,observer.patches)}var temp=observer.patches;return temp.length>0&&(observer.patches=[],observer.callback&&observer.callback(temp)),temp}function _generate(mirror,obj,patches,path){for(var newKeys=_objectKeys(obj),oldKeys=_objectKeys(mirror),changed=!1,deleted=!1,t=oldKeys.length-1;t>=0;t--){var key=oldKeys[t],oldVal=mirror[key];if(obj.hasOwnProperty(key)){var newVal=obj[key];"object"==typeof oldVal&&null!=oldVal&&"object"==typeof newVal&&null!=newVal?_generate(oldVal,newVal,patches,path+"/"+escapePathComponent(key)):oldVal!=newVal&&(changed=!0,patches.push({op:"replace",path:path+"/"+escapePathComponent(key),value:deepClone(newVal)}))}else patches.push({op:"remove",path:path+"/"+escapePathComponent(key)}),deleted=!0}if(deleted||newKeys.length!=oldKeys.length)for(var t=0;t<newKeys.length;t++){var key=newKeys[t];mirror.hasOwnProperty(key)||patches.push({op:"add",path:path+"/"+escapePathComponent(key),value:deepClone(obj[key])})}}function isInteger(str){for(var charCode,i=0,len=str.length;len>i;){charCode=str.charCodeAt(i);{if(!(charCode>=48&&57>=charCode))return!1;i++}}return!0}function apply(tree,patches,validate){for(var patch,key,result=!1,p=0,plen=patches.length;plen>p;){patch=patches[p],p++;for(var path=patch.path||"",keys=path.split("/"),obj=tree,t=1,len=keys.length,existingPathFragment=void 0;;){if(key=keys[t],validate&&void 0===existingPathFragment&&(void 0===obj[key]?existingPathFragment=keys.slice(0,t).join("/"):t==len-1&&(existingPathFragment=patch.path),void 0!==existingPathFragment&&this.validator(patch,p-1,tree,existingPathFragment)),t++,void 0===key&&t>=len){result=rootOps[patch.op].call(patch,obj,key,tree);break}if(_isArray(obj)){if("-"===key)key=obj.length;else{if(validate&&!isInteger(key))throw new JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",p-1,patch.path,patch);key=parseInt(key,10)}if(t>=len){if(validate&&"add"===patch.op&&key>obj.length)throw new JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",p-1,patch.path,patch);result=arrOps[patch.op].call(patch,obj,key,tree);break}}else if(key&&-1!=key.indexOf("~")&&(key=key.replace(/~1/g,"/").replace(/~0/g,"~")),t>=len){result=objOps[patch.op].call(patch,obj,key,tree);break}obj=obj[key]}}return result}function compare(tree1,tree2){var patches=[];return _generate(tree1,tree2,patches,""),patches}function hasUndefined(obj){if(void 0===obj)return!0;if("array"==typeof obj||"object"==typeof obj)for(var i in obj)if(hasUndefined(obj[i]))return!0;return!1}function validator(operation,index,tree,existingPathFragment){if("object"!=typeof operation||null===operation||_isArray(operation))throw new JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",index,operation,tree);if(!objOps[operation.op])throw new JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",index,operation,tree);if("string"!=typeof operation.path)throw new JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",index,operation,tree);if(("move"===operation.op||"copy"===operation.op)&&"string"!=typeof operation.from)throw new JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",index,operation,tree);if(("add"===operation.op||"replace"===operation.op||"test"===operation.op)&&void 0===operation.value)throw new JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",index,operation,tree);if(("add"===operation.op||"replace"===operation.op||"test"===operation.op)&&hasUndefined(operation.value))throw new JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",index,operation,tree);if(tree)if("add"==operation.op){var pathLen=operation.path.split("/").length,existingPathLen=existingPathFragment.split("/").length;if(pathLen!==existingPathLen+1&&pathLen!==existingPathLen)throw new JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",index,operation,tree)}else if("replace"===operation.op||"remove"===operation.op||"_get"===operation.op){if(operation.path!==existingPathFragment)throw new JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",index,operation,tree)}else if("move"===operation.op||"copy"===operation.op){var existingValue={op:"_get",path:operation.from,value:void 0},error=jsonpatch.validate([existingValue],tree);if(error&&"OPERATION_PATH_UNRESOLVABLE"===error.name)throw new JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",index,operation,tree)}}function validate(sequence,tree){try{if(!_isArray(sequence))throw new JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(tree)tree=JSON.parse(JSON.stringify(tree)),apply.call(this,tree,sequence,!0);else for(var i=0;i<sequence.length;i++)this.validator(sequence[i],i)}catch(e){if(e instanceof JsonPatchError)return e;throw e}}if(!jsonpatch.observe){var _objectKeys=function(){return Object.keys?Object.keys:function(o){var keys=[];for(var i in o)o.hasOwnProperty(i)&&keys.push(i);return keys}}(),objOps={add:function(obj,key){return obj[key]=this.value,!0},remove:function(obj,key){return delete obj[key],!0},replace:function(obj,key){return obj[key]=this.value,!0},move:function(obj,key,tree){var temp={op:"_get",path:this.from};return apply(tree,[temp]),apply(tree,[{op:"remove",path:this.from}]),apply(tree,[{op:"add",path:this.path,value:temp.value}]),!0},copy:function(obj,key,tree){var temp={op:"_get",path:this.from};return apply(tree,[temp]),apply(tree,[{op:"add",path:this.path,value:temp.value}]),!0},test:function(obj,key){return _equals(obj[key],this.value)},_get:function(obj,key){this.value=obj[key]}},arrOps={add:function(arr,i){return arr.splice(i,0,this.value),!0},remove:function(arr,i){return arr.splice(i,1),!0},replace:function(arr,i){
return arr[i]=this.value,!0},move:objOps.move,copy:objOps.copy,test:objOps.test,_get:objOps._get},rootOps={add:function(obj){rootOps.remove.call(this,obj);for(var key in this.value)this.value.hasOwnProperty(key)&&(obj[key]=this.value[key]);return!0},remove:function(obj){for(var key in obj)obj.hasOwnProperty(key)&&objOps.remove.call(this,obj,key);return!0},replace:function(obj){return apply(obj,[{op:"remove",path:this.path}]),apply(obj,[{op:"add",path:this.path,value:this.value}]),!0},move:objOps.move,copy:objOps.copy,test:function(obj){return JSON.stringify(obj)===JSON.stringify(this.value)},_get:function(obj){this.value=obj}},observeOps={add:function(patches,path){var patch={op:"add",path:path+escapePathComponent(this.name),value:this.object[this.name]};patches.push(patch)},"delete":function(patches,path){var patch={op:"remove",path:path+escapePathComponent(this.name)};patches.push(patch)},update:function(patches,path){var patch={op:"replace",path:path+escapePathComponent(this.name),value:this.object[this.name]};patches.push(patch)}},beforeDict=[];jsonpatch.intervals;var Mirror=function(){function Mirror(obj){this.observers=[],this.obj=obj}return Mirror}(),ObserverInfo=function(){function ObserverInfo(callback,observer){this.callback=callback,this.observer=observer}return ObserverInfo}();jsonpatch.unobserve=unobserve,jsonpatch.observe=observe,jsonpatch.generate=generate;var _isArray;_isArray=Array.isArray?Array.isArray:function(obj){return obj.push&&"number"==typeof obj.length},jsonpatch.apply=apply,jsonpatch.compare=compare;var JsonPatchError=function(_super){function JsonPatchError(message,name,index,operation,tree){_super.call(this,message),this.message=message,this.name=name,this.index=index,this.operation=operation,this.tree=tree}return __extends(JsonPatchError,_super),JsonPatchError}(OriginalError);jsonpatch.JsonPatchError=JsonPatchError,jsonpatch.Error=JsonPatchError,jsonpatch.validator=validator,jsonpatch.validate=validate}}(jsonpatch||(jsonpatch={})),"undefined"!=typeof exports&&(exports.apply=jsonpatch.apply,exports.observe=jsonpatch.observe,exports.unobserve=jsonpatch.unobserve,exports.generate=jsonpatch.generate,exports.compare=jsonpatch.compare,exports.validate=jsonpatch.validate,exports.validator=jsonpatch.validator,exports.JsonPatchError=jsonpatch.JsonPatchError,exports.Error=jsonpatch.Error)},{}],14:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],15:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],16:[function(require,module,exports){var isArray=Array.isArray,str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],17:[function(require,module,exports){exports.encode=require("./encode").encode,exports.decode=require("./decode").decode,exports.Encoder=require("./encoder").Encoder,exports.Decoder=require("./decoder").Decoder},{"./decode":21,"./decoder":22,"./encode":24,"./encoder":25}],18:[function(require,module,exports){function writeString(string,start){for(var buffer=this,index=start||0,length=string.length,i=0;length>i;i++){var chr=string.charCodeAt(i);128>chr?buffer[index++]=chr:2048>chr?(buffer[index++]=192|chr>>6,buffer[index++]=128|63&chr):(buffer[index++]=224|chr>>12,buffer[index++]=128|chr>>6&63,buffer[index++]=128|63&chr)}return index-start}function readString(start,end){var buffer=this,index=start-0||0;end||(end=buffer.length);var size=end-start;size>MAXBUFLEN&&(size=MAXBUFLEN);for(var out=[];end>index;){for(var array=new Array(size),pos=0;size>pos&&end>index;){var chr=buffer[index++];chr=128>chr?chr:224>chr?(63&chr)<<6|63&buffer[index++]:(63&chr)<<12|(63&buffer[index++])<<6|63&buffer[index++],array[pos++]=chr}size>pos&&(array=array.slice(0,pos)),out.push(String.fromCharCode.apply("",array))}return out.length>1?out.join(""):out.length?out.shift():""}function byteLength(string){var length=0;return Array.prototype.forEach.call(string,function(chr){var code=chr.charCodeAt(0);length+=128>code?1:2048>code?2:3}),length}function copy(target,targetStart,start,end){var i;start||(start=0),end||0===end||(end=this.length),targetStart||(targetStart=0);var len=end-start;if(target===this&&targetStart>start&&end>targetStart)for(i=len-1;i>=0;i--)target[i+targetStart]=this[i+start];else for(i=0;len>i;i++)target[i+targetStart]=this[i+start];return len}function writeUint64BE(value,offset){for(var i=7;i>=0;i--)this[offset+i]=255&value,value/=256}function writeInt64BE(value,offset){if(value>0)return writeUint64BE.call(this,value,offset);value++;for(var i=7;i>=0;i--)this[offset+i]=255&-value^255,value/=256}var MAXBUFLEN=8192;exports.writeString=writeString,exports.readString=readString,exports.byteLength=byteLength,exports.copy=copy,exports.writeUint64BE=writeUint64BE,exports.writeInt64BE=writeInt64BE},{}],19:[function(require,module,exports){exports.BUFFER_SHORTAGE=new Error("BUFFER_SHORTAGE")},{}],20:[function(require,module,exports){(function(Buffer){function DecodeBuffer(options){return this instanceof DecodeBuffer?void(this.options=options||DEFAULT_OPTIONS):new DecodeBuffer(options)}exports.DecodeBuffer=DecodeBuffer;var DEFAULT_OPTIONS={};DecodeBuffer.prototype.push=Array.prototype.push,DecodeBuffer.prototype.read=Array.prototype.shift,DecodeBuffer.prototype.append=function(chunk){var prev=this.offset?this.buffer.slice(this.offset):this.buffer;this.buffer=prev?Buffer.concat([prev,chunk]):chunk,this.offset=0}}).call(this,require("buffer").Buffer)},{buffer:10}],21:[function(require,module,exports){function decode(input,options){var decoder=new DecodeBuffer(options);return decoder.append(input),decode(decoder)}exports.decode=decode;var DecodeBuffer=require("./decode-buffer").DecodeBuffer,decode=require("./read-core").decode},{"./decode-buffer":20,"./read-core":29}],22:[function(require,module,exports){function Decoder(options){return this instanceof Decoder?void DecodeBuffer.call(this,options):new Decoder(options)}exports.Decoder=Decoder;var EventLite=require("event-lite"),DecodeBuffer=require("./decode-buffer").DecodeBuffer,decodeAsync=require("./read-core").decodeAsync;Decoder.prototype=new DecodeBuffer,EventLite.mixin(Decoder.prototype),Decoder.prototype.decode=function(chunk){chunk&&this.append(chunk),decodeAsync(this)},Decoder.prototype.push=function(chunk){this.emit("data",chunk)},Decoder.prototype.end=function(chunk){this.decode(chunk),this.emit("end")}},{"./decode-buffer":20,"./read-core":29,"event-lite":11}],23:[function(require,module,exports){(function(Buffer){function EncodeBuffer(options){return this instanceof EncodeBuffer?void(this.options=options||DEFAULT_OPTIONS):new EncodeBuffer(options)}exports.EncodeBuffer=EncodeBuffer;var MIN_BUFFER_SIZE=2048,MAX_BUFFER_SIZE=65536,DEFAULT_OPTIONS={};EncodeBuffer.prototype.push=function(chunk){var buffers=this.buffers||(this.buffers=[]);buffers.push(chunk)},EncodeBuffer.prototype.read=function(){this.flush();var buffers=this.buffers;if(buffers){var chunk=buffers.length>1?Buffer.concat(buffers):buffers[0];return buffers.length=0,chunk}},EncodeBuffer.prototype.flush=function(){this.start<this.offset&&(this.push(this.buffer.slice(this.start,this.offset)),this.start=this.offset)},EncodeBuffer.prototype.reserve=function(length){if(!this.buffer)return this.alloc(length);var size=this.buffer.length;this.offset+length<size||(this.offset&&this.flush(),this.alloc(Math.max(length,Math.min(2*size,MAX_BUFFER_SIZE))))},EncodeBuffer.prototype.alloc=function(length){this.buffer=new Buffer(length>MIN_BUFFER_SIZE?length:MIN_BUFFER_SIZE),this.start=0,this.offset=0},EncodeBuffer.prototype.send=function(buffer){var end=this.offset+buffer.length;this.buffer&&end<this.buffer.length?(buffer.copy(this.buffer,this.offset),this.offset=end):(this.flush(),this.push(buffer))}}).call(this,require("buffer").Buffer)},{buffer:10}],24:[function(require,module,exports){function encode(input,options){var encoder=new EncodeBuffer(options);return encode(encoder,input),encoder.read()}exports.encode=encode;var encode=require("./write-core").encode,EncodeBuffer=require("./encode-buffer").EncodeBuffer},{"./encode-buffer":23,"./write-core":32}],25:[function(require,module,exports){function Encoder(options){return this instanceof Encoder?void EncodeBuffer.call(this,options):new Encoder(options)}exports.Encoder=Encoder;var EventLite=require("event-lite"),encode=require("./write-core").encode,EncodeBuffer=require("./encode-buffer").EncodeBuffer;Encoder.prototype=new EncodeBuffer,EventLite.mixin(Encoder.prototype),Encoder.prototype.encode=function(chunk){encode(this,chunk),this.emit("data",this.read())},Encoder.prototype.end=function(chunk){arguments.length&&this.encode(chunk),this.flush(),this.emit("end")}},{"./encode-buffer":23,"./write-core":32,"event-lite":11}],26:[function(require,module,exports){function ExtBuffer(buffer,type){return this instanceof ExtBuffer?(this.buffer=buffer,void(this.type=type)):new ExtBuffer(buffer,type)}exports.ExtBuffer=ExtBuffer},{}],27:[function(require,module,exports){(function(Buffer){function init(){preset.addExtPacker(14,Error,join(packError,encode)),preset.addExtPacker(1,EvalError,join(packError,encode)),preset.addExtPacker(2,RangeError,join(packError,encode)),preset.addExtPacker(3,ReferenceError,join(packError,encode)),preset.addExtPacker(4,SyntaxError,join(packError,encode)),preset.addExtPacker(5,TypeError,join(packError,encode)),preset.addExtPacker(6,URIError,join(packError,encode)),preset.addExtUnpacker(14,join(decode,unpackError(Error))),preset.addExtUnpacker(1,join(decode,unpackError(EvalError))),preset.addExtUnpacker(2,join(decode,unpackError(RangeError))),preset.addExtUnpacker(3,join(decode,unpackError(ReferenceError))),preset.addExtUnpacker(4,join(decode,unpackError(SyntaxError))),preset.addExtUnpacker(5,join(decode,unpackError(TypeError))),preset.addExtUnpacker(6,join(decode,unpackError(URIError))),preset.addExtPacker(10,RegExp,join(packRegExp,encode)),preset.addExtPacker(11,Boolean,join(packValueOf,encode)),preset.addExtPacker(12,String,join(packValueOf,encode)),preset.addExtPacker(13,Date,join(Number,encode)),preset.addExtPacker(15,Number,join(packValueOf,encode)),preset.addExtUnpacker(10,join(decode,unpackRegExp)),preset.addExtUnpacker(11,join(decode,unpackClass(Boolean))),preset.addExtUnpacker(12,join(decode,unpackClass(String))),preset.addExtUnpacker(13,join(decode,unpackClass(Date))),preset.addExtUnpacker(15,join(decode,unpackClass(Number))),"undefined"!=typeof Uint8Array&&(preset.addExtPacker(17,Int8Array,packBuffer),preset.addExtPacker(18,Uint8Array,packBuffer),preset.addExtPacker(19,Int16Array,packTypedArray),preset.addExtPacker(20,Uint16Array,packTypedArray),preset.addExtPacker(21,Int32Array,packTypedArray),preset.addExtPacker(22,Uint32Array,packTypedArray),preset.addExtPacker(23,Float32Array,packTypedArray),preset.addExtUnpacker(17,unpackClass(Int8Array)),preset.addExtUnpacker(18,unpackClass(Uint8Array)),preset.addExtUnpacker(19,join(unpackArrayBuffer,unpackClass(Int16Array))),preset.addExtUnpacker(20,join(unpackArrayBuffer,unpackClass(Uint16Array))),preset.addExtUnpacker(21,join(unpackArrayBuffer,unpackClass(Int32Array))),preset.addExtUnpacker(22,join(unpackArrayBuffer,unpackClass(Uint32Array))),preset.addExtUnpacker(23,join(unpackArrayBuffer,unpackClass(Float32Array))),"undefined"!=typeof Float64Array&&(preset.addExtPacker(24,Float64Array,packTypedArray),preset.addExtUnpacker(24,join(unpackArrayBuffer,unpackClass(Float64Array)))),"undefined"!=typeof Uint8ClampedArray&&(preset.addExtPacker(25,Uint8ClampedArray,packBuffer),preset.addExtUnpacker(25,unpackClass(Uint8ClampedArray))),preset.addExtPacker(26,ArrayBuffer,packArrayBuffer),preset.addExtPacker(29,DataView,packTypedArray),preset.addExtUnpacker(26,unpackArrayBuffer),preset.addExtUnpacker(29,join(unpackArrayBuffer,unpackClass(DataView))))}function join(filters){function iterator(value,filter){return filter(value)}return filters=Array.prototype.slice.call(arguments),function(value){return filters.reduce(iterator,value)}}function packBuffer(value){return new Buffer(value)}function packValueOf(value){return value.valueOf()}function packRegExp(value){value=RegExp.prototype.toString.call(value).split("/"),value.shift();var out=[value.pop()];return out.unshift(value.join("/")),out}function unpackRegExp(value){return RegExp.apply(null,value)}function packError(value){var out={};for(var key in ERROR_COLUMNS)out[key]=value[key];return out}function unpackError(Class){return function(value){var out=new Class;for(var key in ERROR_COLUMNS)out[key]=value[key];return out}}function unpackClass(Class){return function(value){return new Class(value)}}function packTypedArray(value){return new Buffer(new Uint8Array(value.buffer))}function packArrayBuffer(value){return new Buffer(new Uint8Array(value))}function unpackArrayBuffer(value){return new Uint8Array(value).buffer}var Ext=require("./ext").Ext,preset=exports.preset=new Ext,encode=require("./encode").encode,decode=require("./decode").decode,ERROR_COLUMNS={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};init()}).call(this,require("buffer").Buffer)},{"./decode":21,"./encode":24,"./ext":28,buffer:10}],28:[function(require,module,exports){function Ext(){return this instanceof Ext?(this.extPackers={},void(this.extUnpackers=[])):new Ext}exports.Ext=Ext;var ExtBuffer=require("./ext-buffer").ExtBuffer;Ext.prototype.addExtPacker=function(etype,Class,packer){function extPacker(value){var buffer=packer(value);return new ExtBuffer(buffer,etype)}var name=Class.name;if(name&&"Object"!==name)this.extPackers[name]=extPacker;else{var list=this.extEncoderList||(this.extEncoderList=[]);list.unshift([Class,extPacker])}},Ext.prototype.addExtUnpacker=function(etype,unpacker){this.extUnpackers[etype]=unpacker},Ext.prototype.getExtPacker=function(value){var c=value.constructor,e=c&&c.name&&this.extPackers[c.name];if(e)return e;var list=this.extEncoderList;if(list)for(var len=list.length,i=0;len>i;i++){var pair=list[i];if(c===pair[0])return pair[1]}},Ext.prototype.getExtUnpacker=function(type){function extUnpacker(buffer){return new ExtBuffer(buffer,type)}return this.extUnpackers[type]||extUnpacker}},{"./ext-buffer":26}],29:[function(require,module,exports){function decode(decoder){var type=uint8(decoder),func=token[type];if(!func)throw new Error("Invalid type: "+(type?"0x"+type.toString(16):type));return func(decoder)}function decodeAsync(decoder){for(;decoder.offset<decoder.buffer.length;){var value,start=decoder.offset;try{value=decode(decoder)}catch(e){if(e!==BUFFER_SHORTAGE)throw e;decoder.offset=start;break}decoder.push(value)}}exports.decode=decode,exports.decodeAsync=decodeAsync;var uint8=require("./read-format").format.uint8,token=require("./read-token").token,BUFFER_SHORTAGE=require("./common").BUFFER_SHORTAGE},{"./common":19,"./read-format":30,"./read-token":31}],30:[function(require,module,exports){(function(Buffer){function map(decoder,len){var i,value={},k=new Array(len),v=new Array(len);for(i=0;len>i;i++)k[i]=decode(decoder),v[i]=decode(decoder);for(i=0;len>i;i++)value[k[i]]=v[i];return value}function array(decoder,len){for(var value=new Array(len),i=0;len>i;i++)value[i]=decode(decoder);return value}function str(decoder,len){var start=decoder.offset,end=decoder.offset=start+len;if(end>decoder.buffer.length)throw BUFFER_SHORTAGE;return IS_BUFFER_SHIM?BufferLite.readString.call(decoder.buffer,start,end):decoder.buffer.toString("utf-8",start,end)}function bin(decoder,len){var start=decoder.offset,end=decoder.offset=start+len;if(end>decoder.buffer.length)throw BUFFER_SHORTAGE;return decoder.buffer.slice(start,end)}function ext(decoder,len){var start=decoder.offset,end=decoder.offset=start+len+1;if(end>decoder.buffer.length)throw BUFFER_SHORTAGE;var type=decoder.buffer[start],unpack=codec.getExtUnpacker(type);if(!unpack)throw new Error("Invalid ext type: "+(type?"0x"+type.toString(16):type));var buf=decoder.buffer.slice(start+1,end);return unpack(buf)}function uint8(decoder){var buffer=decoder.buffer;if(decoder.offset>=buffer.length)throw BUFFER_SHORTAGE;return buffer[decoder.offset++]}function uint16(decoder){var buffer=decoder.buffer;if(decoder.offset+2>buffer.length)throw BUFFER_SHORTAGE;return buffer[decoder.offset++]<<8|buffer[decoder.offset++]}function read(len,method){return function(decoder){var start=decoder.offset,end=decoder.offset=start+len;if(end>decoder.buffer.length)throw BUFFER_SHORTAGE;return method.call(decoder.buffer,start,NO_ASSERT)}}function readUInt64BE(start,noAssert){var upper=this.readUInt32BE(start,noAssert),lower=this.readUInt32BE(start+4,noAssert);return upper?4294967296*upper+lower:lower}function readInt64BE(start,noAssert){var upper=this.readInt32BE(start,noAssert),lower=this.readUInt32BE(start+4,noAssert);return upper?4294967296*upper+lower:lower}exports.format={map:map,array:array,str:str,bin:bin,ext:ext,uint8:uint8,uint16:uint16,uint32:read(4,Buffer.prototype.readUInt32BE),uint64:read(8,readUInt64BE),int8:read(1,Buffer.prototype.readInt8),int16:read(2,Buffer.prototype.readInt16BE),int32:read(4,Buffer.prototype.readInt32BE),int64:read(8,readInt64BE),float32:read(4,Buffer.prototype.readFloatBE),float64:read(8,Buffer.prototype.readDoubleBE)};var BufferLite=require("./buffer-lite"),decode=require("./read-core").decode,codec=require("./ext-preset").preset,BUFFER_SHORTAGE=require("./common").BUFFER_SHORTAGE,IS_BUFFER_SHIM="TYPED_ARRAY_SUPPORT"in Buffer,NO_ASSERT=!0}).call(this,require("buffer").Buffer)},{"./buffer-lite":18,"./common":19,"./ext-preset":27,"./read-core":29,buffer:10}],31:[function(require,module,exports){function init(){var i;for(i=0;127>=i;i++)token[i]=constant(i);for(i=128;143>=i;i++)token[i]=fix(i-128,format.map);for(i=144;159>=i;i++)token[i]=fix(i-144,format.array);for(i=160;191>=i;i++)token[i]=fix(i-160,format.str);for(token[192]=constant(null),token[193]=null,token[194]=constant(!1),token[195]=constant(!0),token[196]=flex(format.uint8,format.bin),token[197]=flex(format.uint16,format.bin),token[198]=flex(format.uint32,format.bin),token[199]=flex(format.uint8,format.ext),token[200]=flex(format.uint16,format.ext),token[201]=flex(format.uint32,format.ext),token[202]=format.float32,token[203]=format.float64,token[204]=format.uint8,token[205]=format.uint16,token[206]=format.uint32,token[207]=format.uint64,token[208]=format.int8,token[209]=format.int16,token[210]=format.int32,token[211]=format.int64,token[212]=fix(1,format.ext),token[213]=fix(2,format.ext),token[214]=fix(4,format.ext),token[215]=fix(8,format.ext),token[216]=fix(16,format.ext),token[217]=flex(format.uint8,format.str),token[218]=flex(format.uint16,format.str),token[219]=flex(format.uint32,format.str),token[220]=flex(format.uint16,format.array),token[221]=flex(format.uint32,format.array),token[222]=flex(format.uint16,format.map),token[223]=flex(format.uint32,format.map),i=224;255>=i;i++)token[i]=constant(i-256)}function constant(value){return function(){return value}}function flex(lenFunc,decodeFunc){return function(decoder){var len=lenFunc(decoder);return decodeFunc(decoder,len)}}function fix(len,method){return function(decoder){return method(decoder,len)}}var token=exports.token=new Array(256),format=require("./read-format").format;init()},{"./read-format":30}],32:[function(require,module,exports){function encode(encoder,value){var func=type[typeof value];if(!func)throw new Error('Unsupported type "'+typeof value+'": '+value);func(encoder,value)}exports.encode=encode;var type=require("./write-type").type},{"./write-type":34}],33:[function(require,module,exports){(function(Buffer){function init(){for(var i=0;255>=i;i++)token[i]=uint8[i];NO_TYPED_ARRAY?init_compatible():init_optimized()}function init_optimized(){token[196]=write1(196),token[197]=write2(197),token[198]=write4(198),token[199]=write1(199),token[200]=write2(200),token[201]=write4(201),token[202]=writeN(202,4,Buffer.prototype.writeFloatBE),token[203]=writeN(203,8,Buffer.prototype.writeDoubleBE),token[204]=write1(204),token[205]=write2(205),token[206]=write4(206),token[207]=writeN(207,8,BufferLite.writeUint64BE),token[208]=write1(208),token[209]=write2(209),token[210]=write4(210),token[211]=writeN(211,8,BufferLite.writeUint64BE),token[217]=write1(217),token[218]=write2(218),token[219]=write4(219),token[220]=write2(220),token[221]=write4(221),token[222]=write2(222),token[223]=write4(223)}function init_compatible(){token[196]=writeN(196,1,Buffer.prototype.writeUInt8),token[197]=writeN(197,2,Buffer.prototype.writeUInt16BE),token[198]=writeN(198,4,Buffer.prototype.writeUInt32BE),token[199]=writeN(199,1,Buffer.prototype.writeUInt8),token[200]=writeN(200,2,Buffer.prototype.writeUInt16BE),token[201]=writeN(201,4,Buffer.prototype.writeUInt32BE),token[202]=writeN(202,4,Buffer.prototype.writeFloatBE),token[203]=writeN(203,8,Buffer.prototype.writeDoubleBE),token[204]=writeN(204,1,Buffer.prototype.writeUInt8),token[205]=writeN(205,2,Buffer.prototype.writeUInt16BE),token[206]=writeN(206,4,Buffer.prototype.writeUInt32BE),token[207]=writeN(207,8,BufferLite.writeUint64BE),token[208]=writeN(208,1,Buffer.prototype.writeInt8),token[209]=writeN(209,2,Buffer.prototype.writeInt16BE),token[210]=writeN(210,4,Buffer.prototype.writeInt32BE),token[211]=writeN(211,8,BufferLite.writeUint64BE),token[217]=writeN(217,1,Buffer.prototype.writeUInt8),token[218]=writeN(218,2,Buffer.prototype.writeUInt16BE),token[219]=writeN(219,4,Buffer.prototype.writeUInt32BE),token[220]=writeN(220,2,Buffer.prototype.writeUInt16BE),token[221]=writeN(221,4,Buffer.prototype.writeUInt32BE),token[222]=writeN(222,2,Buffer.prototype.writeUInt16BE),token[223]=writeN(223,4,Buffer.prototype.writeUInt32BE)}function write1(type){return function(encoder,value){encoder.reserve(2);var buffer=encoder.buffer,offset=encoder.offset;buffer[offset++]=type,buffer[offset++]=value,encoder.offset=offset}}function write2(type){return function(encoder,value){encoder.reserve(3);var buffer=encoder.buffer,offset=encoder.offset;buffer[offset++]=type,buffer[offset++]=value>>>8,buffer[offset++]=value,encoder.offset=offset}}function write4(type){return function(encoder,value){encoder.reserve(5);var buffer=encoder.buffer,offset=encoder.offset;buffer[offset++]=type,buffer[offset++]=value>>>24,buffer[offset++]=value>>>16,buffer[offset++]=value>>>8,buffer[offset++]=value,encoder.offset=offset}}function writeN(type,len,method){return function(encoder,value){encoder.reserve(len+1),encoder.buffer[encoder.offset++]=type,method.call(encoder.buffer,value,encoder.offset,NO_ASSERT),encoder.offset+=len}}var token=exports.token=new Array(256),BufferLite=require("./buffer-lite"),uint8=require("./write-uint8").uint8,NO_ASSERT=!0,IS_BUFFER_SHIM="TYPED_ARRAY_SUPPORT"in Buffer,NO_TYPED_ARRAY=IS_BUFFER_SHIM&&!Buffer.TYPED_ARRAY_SUPPORT;init()}).call(this,require("buffer").Buffer)},{"./buffer-lite":18,"./write-uint8":35,buffer:10}],34:[function(require,module,exports){(function(Buffer){function bool(encoder,value){var type=value?195:194;token[type](encoder,value)}function number(encoder,value){var type,ivalue=0|value;return value!==ivalue?(type=203,void token[type](encoder,value)):(type=ivalue>=-32&&127>=ivalue?255&ivalue:ivalue>=0?255>=ivalue?204:65535>=ivalue?205:206:ivalue>=-128?208:ivalue>=-32768?209:210,void token[type](encoder,ivalue))}function string(encoder,value){var length=value.length,maxsize=5+3*length;encoder.reserve(maxsize);var expected=32>length?1:255>=length?2:65535>=length?3:5,start=encoder.offset+expected;length=BufferLite.writeString.call(encoder.buffer,value,start);var actual=32>length?1:255>=length?2:65535>=length?3:5;if(expected!==actual){var targetStart=encoder.offset+actual,end=start+length;IS_BUFFER_SHIM?BufferLite.copy.call(encoder.buffer,encoder.buffer,targetStart,start,end):encoder.buffer.copy(encoder.buffer,targetStart,start,end)}var type=1===actual?160+length:3>=actual?215+actual:219;token[type](encoder,length),encoder.offset+=length}function object(encoder,value){if(IS_ARRAY(value))return array(encoder,value);if(null===value)return nil(encoder,value);var packer=codec.getExtPacker(value);return packer&&(value=packer(value)),value instanceof ExtBuffer?ext(encoder,value):Buffer.isBuffer(value)?bin(encoder,value):void map(encoder,value)}function nil(encoder,value){var type=192;token[type](encoder,value)}function array(encoder,value){var length=value.length,type=16>length?144+length:65535>=length?220:221;token[type](encoder,length);for(var i=0;length>i;i++)encode(encoder,value[i])}function bin(encoder,value){var length=value.length,type=255>length?196:65535>=length?197:198;token[type](encoder,length),encoder.send(value)}function ext(encoder,value){var buffer=value.buffer,length=buffer.length,type=extmap[length]||(255>length?199:65535>=length?200:201);token[type](encoder,length),uint8[value.type](encoder),encoder.send(buffer)}function map(encoder,value){var keys=Object.keys(value),length=keys.length,type=16>length?128+length:65535>=length?222:223;token[type](encoder,length),keys.forEach(function(key){encode(encoder,key),encode(encoder,value[key])})}function isArray(array){return"[object Array]"===Object.prototype.toString.call(array)}exports.type={"boolean":bool,"function":nil,number:number,object:object,string:string,symbol:nil,undefined:nil};var BufferLite=require("./buffer-lite"),token=require("./write-token").token,encode=require("./write-core").encode,uint8=require("./write-uint8").uint8,codec=require("./ext-preset").preset,ExtBuffer=require("./ext-buffer").ExtBuffer,IS_BUFFER_SHIM="TYPED_ARRAY_SUPPORT"in Buffer,IS_ARRAY=Array.isArray||isArray,extmap=[];extmap[1]=212,extmap[2]=213,extmap[4]=214,extmap[8]=215,extmap[16]=216}).call(this,require("buffer").Buffer)},{"./buffer-lite":18,"./ext-buffer":26,"./ext-preset":27,"./write-core":32,"./write-token":33,"./write-uint8":35,buffer:10}],35:[function(require,module,exports){function write0(type){return function(encoder){encoder.reserve(1),encoder.buffer[encoder.offset++]=type}}for(var constant=exports.uint8=new Array(256),i=0;255>=i;i++)constant[i]=write0(i)},{}],36:[function(require,module,exports){module.exports=require("./lib/checks")},{"./lib/checks":37}],37:[function(require,module,exports){function failCheck(ExceptionConstructor,callee,messageFormat,formatArgs){messageFormat=messageFormat||"";var message=util.format.apply(this,[messageFormat].concat(formatArgs)),error=new ExceptionConstructor(message);throw Error.captureStackTrace(error,callee),error}function failArgumentCheck(callee,message,formatArgs){failCheck(errors.IllegalArgumentError,callee,message,formatArgs)}function failStateCheck(callee,message,formatArgs){failCheck(errors.IllegalStateError,callee,message,formatArgs)}function typeOf(value){var s=typeof value;if("object"==s){if(!value)return"null";if(value instanceof Array)return"array"}return s}function typeCheck(expect){return function(value,message){var type=typeOf(value);return type==expect?value:void failArgumentCheck(arguments.callee,message||'Expected "'+expect+'" but got "'+type+'".',Array.prototype.slice.call(arguments,2))}}var util=require("util"),errors=module.exports=require("./errors");module.exports.checkArgument=function(value,message){value||failArgumentCheck(arguments.callee,message,Array.prototype.slice.call(arguments,2))},module.exports.checkState=function(value,message){value||failStateCheck(arguments.callee,message,Array.prototype.slice.call(arguments,2))},module.exports.checkIsDef=function(value,message){return void 0!==value?value:void failArgumentCheck(arguments.callee,message||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},module.exports.checkIsDefAndNotNull=function(value,message){return null!=value?value:void failArgumentCheck(arguments.callee,message||'Expected value to be defined and not null but got "'+typeOf(value)+'".',Array.prototype.slice.call(arguments,2))},module.exports.checkIsString=typeCheck("string"),module.exports.checkIsArray=typeCheck("array"),module.exports.checkIsNumber=typeCheck("number"),module.exports.checkIsBoolean=typeCheck("boolean"),module.exports.checkIsFunction=typeCheck("function"),module.exports.checkIsObject=typeCheck("object")},{"./errors":38,util:41}],38:[function(require,module,exports){function IllegalArgumentError(message){Error.call(this,message),this.message=message}function IllegalStateError(message){Error.call(this,message),this.message=message}var util=require("util");util.inherits(IllegalArgumentError,Error),IllegalArgumentError.prototype.name="IllegalArgumentError",util.inherits(IllegalStateError,Error),IllegalStateError.prototype.name="IllegalStateError",module.exports.IllegalStateError=IllegalStateError,module.exports.IllegalArgumentError=IllegalArgumentError},{util:41}],39:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],40:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],41:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),
arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":40,_process:39,inherits:15}],42:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),backoff=require("backoff"),WebSocketClient=function(){function WebSocketClient(url){var protocols=arguments.length<=1||void 0===arguments[1]?null:arguments[1],options=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];_classCallCheck(this,WebSocketClient),this.url=url,this._protocols=protocols,this.reconnectEnabled=!0,this.listeners={},this.backoff=backoff[options.backoff||"fibonacci"](options),this.backoff.on("backoff",this.onBackoffStart.bind(this)),this.backoff.on("ready",this.onBackoffReady.bind(this)),this.backoff.on("fail",this.onBackoffFail.bind(this)),this.open()}return _createClass(WebSocketClient,[{key:"open",value:function(){var reconnect=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];this.isReconnect=reconnect,this.ws=new WebSocket(this.url,this._protocols),this.ws.onclose=this.onCloseCallback.bind(this),this.ws.onerror=this.onErrorCallback.bind(this),this.ws.onmessage=this.onMessageCallback.bind(this),this.ws.onopen=this.onOpenCallback.bind(this)}},{key:"onBackoffStart",value:function(number,delay){}},{key:"onBackoffReady",value:function(number,delay){this.open(!0)}},{key:"onBackoffFail",value:function(){}},{key:"onCloseCallback",value:function(){!this.isReconnect&&this.listeners.onclose&&this.listeners.onclose.apply(null,arguments),this.reconnectEnabled&&this.backoff.backoff()}},{key:"onErrorCallback",value:function(){this.listeners.onerror&&this.listeners.onerror.apply(null,arguments)}},{key:"onMessageCallback",value:function(){this.listeners.onmessage&&this.listeners.onmessage.apply(null,arguments)}},{key:"onOpenCallback",value:function(){this.listeners.onopen&&this.listeners.onopen.apply(null,arguments),this.isReconnect&&this.listeners.onreconnect&&this.listeners.onreconnect.apply(null,arguments),this.isReconnect=!1}},{key:"close",value:function(code,reason){"undefined"==typeof code&&(code=1e3),this.reconnectEnabled=!1,this.ws.close(code,reason)}},{key:"send",value:function(data){this.ws.send(data)}},{key:"bufferedAmount",get:function(){return this.ws.bufferedAmount}},{key:"readyState",get:function(){return this.ws.readyState}},{key:"binaryType",get:function(){return this.ws.binaryType},set:function(binaryType){this.ws.binaryType=binaryType}},{key:"extensions",get:function(){return this.ws.extensions},set:function(extensions){this.ws.extensions=extensions}},{key:"protocol",get:function(){return this.ws.protocol},set:function(protocol){this.ws.protocol=protocol}},{key:"onclose",set:function(listener){this.listeners.onclose=listener},get:function(){return this.listeners.onclose}},{key:"onerror",set:function(listener){this.listeners.onerror=listener},get:function(){return this.listeners.onerror}},{key:"onmessage",set:function(listener){this.listeners.onmessage=listener},get:function(){return this.listeners.onmessage}},{key:"onopen",set:function(listener){this.listeners.onopen=listener},get:function(){return this.listeners.onopen}},{key:"onreconnect",set:function(listener){this.listener.onreconnect=listener},get:function(){return this.listeners.onreconnect}}]),WebSocketClient}();WebSocketClient.CONNECTING=WebSocket.CONNECTING,WebSocketClient.OPEN=WebSocket.OPEN,WebSocketClient.CLOSING=WebSocket.CLOSING,WebSocketClient.CLOSED=WebSocket.CLOSED,module.exports=WebSocketClient},{backoff:3}],43:[function(require,module,exports){"use strict";module.exports.USER_ID=1,module.exports.JOIN_ROOM=10,module.exports.JOIN_ERROR=12,module.exports.LEAVE_ROOM=12,module.exports.ROOM_DATA=13,module.exports.ROOM_STATE=14,module.exports.ROOM_STATE_PATCH=15,module.exports.BAD_REQUEST=50},{}]},{},[1])(1)});
